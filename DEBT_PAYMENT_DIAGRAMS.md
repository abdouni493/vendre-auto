# Debt Payment Feature - Visual Diagrams

## 1. User Interaction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SALES HISTORY VIEW                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Sale Card #1     â”‚  â”‚ Sale Card #2     â”‚  â”‚ Sale Card #3 â”‚  â”‚
â”‚  â”‚ Status: âœ…       â”‚  â”‚ Status: â³       â”‚  â”‚ Status: â³    â”‚  â”‚
â”‚  â”‚ Balance: 0 DA    â”‚  â”‚ Balance: 500k DA â”‚  â”‚ Balance: 1M   â”‚  â”‚
â”‚  â”‚ (No Payer Btn)   â”‚  â”‚ [ğŸ’³ Payer Btn]   â”‚  â”‚ [ğŸ’³ Payer Btn]â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                         User clicks ğŸ’³ Payer
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PAYMENT MODAL OPENS                                 â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ’³ Paiement de Dette                                    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ ğŸ“‹ RÃ©sumÃ©:                                              â”‚   â”‚
â”‚  â”‚ â€¢ VÃ©hicule: Toyota Camry 2020                          â”‚   â”‚
â”‚  â”‚ â€¢ Client: Ahmed Mourabit                               â”‚   â”‚
â”‚  â”‚ â€¢ Montant Total: 1,000,000 DA ğŸ”µ                       â”‚   â”‚
â”‚  â”‚ â€¢ DÃ©jÃ  PayÃ©: 500,000 DA ğŸŸ¢                             â”‚   â”‚
â”‚  â”‚ â€¢ Solde Restant: 500,000 DA ğŸ”´                         â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ ğŸ’° Montant Ã  Payer:                                     â”‚   â”‚
â”‚  â”‚ [         500000         ] DA                           â”‚   â”‚
â”‚  â”‚  (User can edit this amount)                            â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ AperÃ§u aprÃ¨s Paiement:                                  â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚ â”‚ â€¢ Nouveau Montant PayÃ©: 700,000 DA ğŸŸ¢          â”‚   â”‚   â”‚
â”‚  â”‚ â”‚ â€¢ Nouveau Solde: 300,000 DA ğŸŸ                  â”‚   â”‚   â”‚
â”‚  â”‚ â”‚ (Color changes based on remaining balance)     â”‚   â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ [Annuler]  [âœ… Enregistrer Paiement]                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        User clicks "Enregistrer Paiement"
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PAYMENT PROCESSING                             â”‚
â”‚                                                                  â”‚
â”‚  â³ Button shows: "â³ Traitement..."                             â”‚
â”‚  â€¢ Payment amount validated                                      â”‚
â”‚  â€¢ New balance calculated                                        â”‚
â”‚  â€¢ Database updated                                              â”‚
â”‚  â€¢ Sale status updated (if balance = 0)                          â”‚
â”‚  â€¢ Sales list refreshed                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SUCCESS NOTIFICATION                           â”‚
â”‚                                                                  â”‚
â”‚  âœ… Paiement enregistrÃ© avec succÃ¨s!                            â”‚
â”‚  Montant payÃ©: 200,000 DA                                       â”‚
â”‚  Solde restant: 300,000 DA                                      â”‚
â”‚                                                                  â”‚
â”‚  [OK]                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SALES HISTORY UPDATED                               â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ Sale Card #2     â”‚  â”‚ Sale Card #3     â”‚                    â”‚
â”‚  â”‚ Status: â³       â”‚  â”‚ Status: â³       â”‚                    â”‚
â”‚  â”‚ Balance: 300k DA â”‚  â”‚ Balance: 1M DA   â”‚                    â”‚
â”‚  â”‚ [ğŸ’³ Payer Btn]   â”‚  â”‚ [ğŸ’³ Payer Btn]   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                  â”‚
â”‚  Modal closes automatically                                      â”‚
â”‚  User can make additional payments                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Payment State Transitions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Initial Sale Created                â”‚
â”‚ Status: 'debt'                      â”‚
â”‚ Balance: 500,000 DA                 â”‚
â”‚ Amount Paid: 500,000 DA             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                                 â”‚                 â”‚
             â–¼                                 â–¼                 â–¼
    Payment 1: 100k      Payment 2: 200k   Payment 3: 200k
    (Partial)            (Partial)         (Complete)
             â”‚                                 â”‚                 â”‚
             â–¼                                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Balance: 400,000 DAâ”‚  â”‚ Balance: 200,000 DAâ”‚  â”‚ Balance: 0 DAâ”‚
â”‚ Status: 'debt' â³   â”‚  â”‚ Status: 'debt' â³   â”‚  â”‚Status: âœ…    â”‚
â”‚ Paid: 600,000 DA   â”‚  â”‚ Paid: 700,000 DA   â”‚  â”‚Paid: 1M DA   â”‚
â”‚ ğŸ’³ Payer visible   â”‚  â”‚ ğŸ’³ Payer visible   â”‚  â”‚ğŸ’³ Hidden     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Database Update Flow

```
Payment Modal Input
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validation                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ paymentAmount > 0                 â”‚
â”‚ âœ“ paymentAmount â‰¤ balance           â”‚
â”‚ âœ“ Sale not already completed        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calculations                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ newBalance = balance - paymentAmount â”‚
â”‚ newAmountPaid = amountPaid + payment â”‚
â”‚ newStatus = newBalance â‰¤ 0 ?        â”‚
â”‚             'completed' : 'debt'    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Update                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UPDATE sales SET                    â”‚
â”‚   amount_paid = newAmountPaid        â”‚
â”‚   balance = newBalance              â”‚
â”‚   status = newStatus                â”‚
â”‚ WHERE id = saleId                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Refresh & Notify                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Fetch updated sales list          â”‚
â”‚ âœ“ Close payment modal               â”‚
â”‚ âœ“ Show success message              â”‚
â”‚ âœ“ Update UI immediately             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Balance Preview Dynamic Colors

```
As user enters payment amount:

Payment < Balance:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nuevo Balance Preview                â”‚
â”‚ ğŸŸ  Still owes money                 â”‚
â”‚ Show orange color                    â”‚
â”‚ Button text: Normal                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Payment = Balance:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nuevo Balance Preview                â”‚
â”‚ ğŸŸ¢ FULLY PAID âœ¨                    â”‚
â”‚ Show green color                     â”‚
â”‚ Show success message:                â”‚
â”‚ "SerÃ¡ marcado COMPLÃˆTE ET PAYÃ‰E"    â”‚
â”‚ Button text: Normal                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Payment > Balance:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR - Cannot exceed balance        â”‚
â”‚ Input max value = remaining balance  â”‚
â”‚ Show error message                   â”‚
â”‚ Button disabled                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Payment = 0:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INVALID - Must pay something         â”‚
â”‚ Button disabled                      â”‚
â”‚ Show min value reminder              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Component State Diagram

```
POS Component State Management
â”‚
â”œâ”€ Sales Data
â”‚  â”œâ”€ allSales: SaleRecord[]
â”‚  â”œâ”€ filteredSales: SaleRecord[] (filtered by debt status)
â”‚  â””â”€ selectedPaymentElement
â”‚
â”œâ”€ Payment Modal State
â”‚  â”œâ”€ paymentModal: { sale, paymentAmount }
â”‚  â””â”€ isProcessingPayment: boolean
â”‚
â”œâ”€ Handlers
â”‚  â”œâ”€ handlePaymentModalOpen()
â”‚  â”‚  â””â”€ Opens modal with sale data
â”‚  â”‚     â””â”€ Pre-fills with remaining balance
â”‚  â”‚
â”‚  â””â”€ handleSavePayment()
â”‚     â”œâ”€ Validate amount
â”‚     â”œâ”€ Calculate new values
â”‚     â”œâ”€ Update database
â”‚     â”œâ”€ Refresh sales list
â”‚     â””â”€ Close modal + show message
â”‚
â””â”€ UI Rendering
   â”œâ”€ Conditionally show ğŸ’³ Payer button
   â”‚  (only if sale.balance > 0)
   â”‚
   â””â”€ Payment Modal
      â”œâ”€ Sale summary
      â”œâ”€ Payment input
      â”œâ”€ Balance preview (dynamic color)
      â””â”€ Action buttons
```

---

## 6. Modal Lifecycle

```
    [Sales History View]
             â”‚
             â–¼
    [ğŸ’³ Payer Button Click]
             â”‚
             â–¼ handlePaymentModalOpen()
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Check: balance <= 0?       â”‚
    â”‚ YES â†’ Show alert, return   â”‚
    â”‚ NO â†’ Continue              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ setPaymentModal({          â”‚
    â”‚   sale: data,              â”‚
    â”‚   paymentAmount: balance   â”‚
    â”‚ })                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PAYMENT MODAL RENDERS      â”‚
    â”‚ â€¢ Show sale details        â”‚
    â”‚ â€¢ Pre-fill with balance    â”‚
    â”‚ â€¢ Ready for user input     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚
        â–¼                 â–¼
   [Annuler]        [Enregistrer]
        â”‚                 â”‚
        â–¼                 â–¼
  setPaymentModal    handleSavePayment()
  (close)            (save to DB)
        â”‚                 â”‚
        â”‚                 â–¼
        â”‚        [Process... â³]
        â”‚                 â”‚
        â”‚                 â–¼
        â”‚        [Refresh + Show Alert]
        â”‚                 â”‚
        â–¼                 â–¼
    [Modal Closes]   [Modal Closes]
        â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
     [Sales List Updated]
        â”œâ”€ New balances shown
        â”œâ”€ Status updated if complete
        â””â”€ ğŸ’³ Button hidden if fully paid
```

---

## 7. Data Structure

```
SaleRecord with Payment:
{
  id: "abc123",
  car_id: "car456",
  car: {
    id: "car456",
    make: "Toyota",
    model: "Camry",
    year: 2020,
    vin: "ABC123XYZ",
    fuel: "Diesel",
    transmission: "Automatic"
  },
  first_name: "Ahmed",
  last_name: "Mourabit",
  mobile1: "+213 5XX XXX XXX",
  total_price: 1000000,           â† Total amount
  amount_paid: 500000,            â† Already paid
  balance: 500000,                â† Still owed
  status: "debt",                 â† Status
  created_at: "2024-01-15",
  created_by: "admin"
}

After Payment of 200,000:
{
  ...same as above...
  amount_paid: 700000,            â† Updated
  balance: 300000,                â† Updated
  status: "debt"                  â† Still debt (not complete)
}

After Final Payment of 300,000:
{
  ...same as above...
  amount_paid: 1000000,           â† Updated to total
  balance: 0,                     â† Fully paid
  status: "completed"             â† Changed to completed âœ…
}
```

---

## 8. Error Handling Flow

```
User Action
     â”‚
     â–¼
handleSavePayment()
     â”‚
     â–¼ try-catch block
     â”‚
  â”Œâ”€â”€â”´â”€â”€â”
  â”‚     â”‚
  â–¼     â–¼
OK    ERROR
  â”‚     â”‚
  â–¼     â–¼
DB   Exception
Update Caught
  â”‚     â”‚
  â–¼     â–¼
Refresh Alert
Sale  Error
List  Message
  â”‚     â”‚
  â–¼     â–¼
Success Failure
Alert  Alert
  â”‚     â”‚
  â””â”€â”€â”¬â”€â”€â”˜
     â”‚
     â–¼ finally block
     â”‚
setIsProcessingPayment(false)
     â”‚
     â–¼
Modal Closes
```

---

## 9. Color Legend

```
ğŸ”µ Blue    = Total Amount (main value)
ğŸŸ¢ Green   = Paid/Complete (positive action)
ğŸ”´ Red     = Debt/Warning (attention needed)
ğŸŸ  Orange  = Partial/Action (pay button)
ğŸŸ¡ Yellow  = Info/Notice
âšª Gray    = Neutral/Background
âš« Black   = Text/Headers

Component Colors:
- Modal Header: Orange gradient
- Sale Summary: Light gray (slate-50)
- Balance Input: Light orange border
- Preview Section: Light gray background
- Success: Green + checkmark
- Error: Red + X mark
- Processing: Animation
```

---

## 10. Responsive Breakpoints

```
Mobile (< 768px):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modal stacks:        â”‚
â”‚ - Header            â”‚
â”‚ - Summary           â”‚
â”‚ - Input (full width)â”‚
â”‚ - Preview           â”‚
â”‚ - Buttons (stacked) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Tablet (768px - 1024px):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modal with more space:     â”‚
â”‚ - Two column layout        â”‚
â”‚ - Comfortable spacing      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Desktop (> 1024px):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Full modal layout:         â”‚
â”‚ - Three column grid        â”‚
â”‚ - Maximum visibility       â”‚
â”‚ - Side-by-side components  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

All visual diagrams are based on the actual implementation in `components/POS.tsx`.
